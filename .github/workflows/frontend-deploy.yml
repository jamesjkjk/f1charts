name: Build and Deploy Angular App to Azure Static Web Apps

on:
  push:
    branches:
      - master
env:
    AZURE_WEBAPP_NAME: f1charts-frontend
    AZURE_WEBAPP_PACKAGE_PATH: "f1charts-SPA/dist/f1charts-SPA"
    NODE_VERSION: "20.x"

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
  
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{env.NODE_VERSION }}  # Adjust the Node.js version as needed
    - name: Install dependencies
      run: npm ci
      working-directory: f1charts-SPA

    - name: Build Angular project
      run: npm run build --prod
      working-directory: f1charts-SPA
      
    - name: 'Deploy to Azure WebApp'
      uses: azure/webapps-deploy@v3
      with:
        app-name: ${{ env.AZURE_WEBAPP_NAME }}
        publish-profile: ${{ secrets.AZURE_FRONTEND_WEB_APPS_API_TOKEN }}
        package: ${{ env.AZURE_WEBAPP_PACKAGE_PATH }}
